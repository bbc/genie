function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function i(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return o(t)}function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=s(t);if(e){var r=s(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l(this,n)}}function u(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2019 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var d=Phaser.Renderer.WebGL.Utils,f={renderWebGL:function(t,e,n,i){if(0!==e.width&&0!==e.height){n.addToRenderList(e);var r=e.frame,s=r.width,a=r.height,o=d.getTintAppendFloatAlpha,l=t.pipelines.set(e.pipeline,e),h=l.setTexture2D(r.glTexture,e);t.pipelines.preBatch(e),l.batchTexture(e,r.glTexture,s,a,e.x,e.y,s/e.style.resolution,a/e.style.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,s,a,o(e.tintTopLeft,n.alpha*e._alphaTL),o(e.tintTopRight,n.alpha*e._alphaTR),o(e.tintBottomLeft,n.alpha*e._alphaBL),o(e.tintBottomRight,n.alpha*e._alphaBR),e.tintFill,0,0,n,i,!1,h),t.pipelines.postBatch(e)}},renderCanvas:function(t,e,n,i){0!==e.width&&0!==e.height&&(n.addToRenderList(e),t.batchSprite(e,e.frame,n,i))}},g=Phaser.Display.Canvas.CanvasPool,v=function(t){var e=g.create(this),n=e.getContext("2d");t.syncFont(e,n);var i=n.measureText(t.testString);if("actualBoundingBoxAscent"in i){var r=i.actualBoundingBoxAscent,s=i.actualBoundingBoxDescent,a={ascent:r,descent:s,fontSize:r+s};return g.remove(e),a}var o=Math.ceil(i.width*t.baselineX),l=o,h=2*l;l=l*t.baselineY|0,e.width=o,e.height=h,n.fillStyle="#f00",n.fillRect(0,0,o,h),n.font=t._font,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(t.testString,0,l);a={ascent:0,descent:0,fontSize:0};if(!n.getImageData(0,0,o,h))return a.ascent=l,a.descent=l+6,a.fontSize=a.ascent+a.descent,g.remove(e),a;var u,c,d=n.getImageData(0,0,o,h).data,f=d.length,v=4*o,y=0,p=!1;for(u=0;u<l;u++){for(c=0;c<v;c+=4)if(255!==d[y+c]){p=!0;break}if(p)break;y+=v}for(a.ascent=l-u,y=f-v,p=!1,u=h;u>l;u--){for(c=0;c<v;c+=4)if(255!==d[y+c]){p=!0;break}if(p)break;y-=v}return a.descent=u-l,a.fontSize=a.ascent+a.descent,g.remove(e),a},y=0,p=1,k=2,x=0,w=1,m=2,S=/(?:\r\n|\r|\n)/,T=Phaser.Utils.String.Pad,b=function(e,n,i){if(null==e)return e;switch(t(e)){case"string":return e;case"number":return"#".concat(T(Math.floor(e).toString(16),6,"0",1));case"function":return e(n,i);case"object":return e.hasOwnProperty("r")?e.hasOwnProperty("a")?"rgba(".concat(e.r,",").concat(e.g,",").concat(e.b,",").concat(e.a,")"):"rgb(".concat(e.r,",").concat(e.g,",").concat(e.b,")"):e.hasOwnProperty("h")?e.hasOwnProperty("a")?"hsla(".concat(e.h,",").concat(e.s,",").concat(e.l,",").concat(e.a,")"):"hsl(".concat(e.h,",").concat(e.s,",").concat(e.l,")"):e;default:return e}},M=Phaser.Utils.Objects.GetAdvancedValue,P=Phaser.Utils.Objects.GetValue,O={backgroundColor:["backgroundColor",null,b],backgroundColor2:["backgroundColor2",null,b],backgroundHorizontalGradient:["backgroundHorizontalGradient",!0,null],backgroundStrokeColor:["backgroundStrokeColor",null,b],backgroundStrokeLineWidth:["backgroundStrokeLineWidth",2,null],backgroundCornerRadius:["backgroundCornerRadius",0,null],backgroundCornerIteration:["backgroundCornerIteration",null,null],fontFamily:["fontFamily","Courier",null],fontSize:["fontSize","16px",null],fontStyle:["fontStyle","",null],color:["color","#fff",b],stroke:["stroke","#fff",b],strokeThickness:["strokeThickness",0,null],shadowOffsetX:["shadow.offsetX",0,null],shadowOffsetY:["shadow.offsetY",0,null],shadowColor:["shadow.color","#000",b],shadowBlur:["shadow.blur",0,null],shadowStroke:["shadow.stroke",!1,null],shadowFill:["shadow.fill",!1,null],underlineColor:["underline.color","#000",b],underlineThickness:["underline.thickness",0,null],underlineOffset:["underline.offset",0,null],halign:["halign","left",null],valign:["valign","top",null],maxLines:["maxLines",0,null],fixedWidth:["fixedWidth",0,null],fixedHeight:["fixedHeight",0,null],resolution:["resolution",0,null],lineSpacing:["lineSpacing",0,null],xOffset:["xOffset",0,null],rtl:["rtl",!1,null],testString:["testString","|MÃ‰qgy",null],baselineX:["baselineX",1.2,null],baselineY:["baselineY",1.4,null],wrapMode:["wrap.mode",0,null],wrapWidth:["wrap.width",0,null],wrapCallback:["wrap.callback",null],wrapCallbackScope:["wrap.callbackScope",null]},C=function(){function t(n,i){e(this,t),this.parent=n,this.backgroundColor,this.backgroundColor2,this.backgroundHorizontalGradient,this.backgroundStrokeColor,this.backgroundStrokeLineWidth,this.backgroundCornerRadius,this.backgroundCornerIteration,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.lineSpacing,this.xOffset,this.rtl,this.testString,this.baselineX,this.baselineY,this.wrapMode,this.wrapWidth,this.wrapCallback,this.wrapCallbackScope,this._font,this.setStyle(i,!1,!0);var r=P(i,"metrics",!1);this.metrics=r?{ascent:P(r,"ascent",0),descent:P(r,"descent",0),fontSize:P(r,"fontSize",0)}:v(this)}return i(t,[{key:"canvas",get:function(){return this.parent.canvasText.canvas}},{key:"context",get:function(){return this.parent.canvasText.context}},{key:"isWrapFitMode",get:function(){return this.fixedWidth>0&&this.wrapMode!==x&&0===this.wrapWidth}},{key:"setStyle",value:function(t,e,n){if(void 0===e&&(e=!0),void 0===n&&(n=!1),t&&t.hasOwnProperty("wrap")){var i=t.wrap;if(i.hasOwnProperty("mode")){var r=i.mode;"string"==typeof r&&(i.mode=F[r])}else i.hasOwnProperty("width")&&(i.mode=1)}for(var s in t&&t.rtl&&n&&!t.hasOwnProperty("halign")&&(t.halign="right"),t&&t.hasOwnProperty("fontSize")&&"number"==typeof t.fontSize&&(t.fontSize=t.fontSize.toString()+"px"),O){var a=O[s],o=a[0],l=n?a[1]:this[s],h=a[2];if("wrapCallback"===s||"wrapCallbackScope"===s)this[s]=P(t,o,l);else{var u=M(t,o,l);h&&(u=h(u)),this[s]=u}}var c=P(t,"font",null);this._font=null===c?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:c;var d=P(t,"fill",null);null!==d&&(this.color=b(d));var f=P(t,"images",void 0);return f&&this.parent.addImage(f),e?this.update(!0):this.parent}},{key:"syncFont",value:function(t,e){e.font=this._font}},{key:"syncStyle",value:function(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round"}},{key:"syncShadow",value:function(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0)}},{key:"update",value:function(t){return t&&(this._font="".concat(this.fontStyle," ").concat(this.fontSize," ").concat(this.fontFamily).trim(),this.metrics=v(this)),this.parent.updateText(t)}},{key:"buildFont",value:function(){var t="".concat(this.fontStyle," ").concat(this.fontSize," ").concat(this.fontFamily).trim();return t!==this._font&&(this._font=t),this}},{key:"setFont",value:function(t){return"string"==typeof t?(this.fontFamily=t,this.fontSize="",this.fontStyle=""):(this.fontFamily=P(t,"fontFamily","Courier"),this.fontSize=P(t,"fontSize","16px"),this.fontStyle=P(t,"fontStyle","")),this.update(!0)}},{key:"setFontFamily",value:function(t){return this.fontFamily=t,this.update(!0)}},{key:"setFontStyle",value:function(t){return this.fontStyle=t,this.update(!0)}},{key:"setFontSize",value:function(t){return"number"==typeof t&&(t=t.toString()+"px"),this.fontSize=t,this.update(!0)}},{key:"setTestString",value:function(t){return this.testString=t,this.update(!0)}},{key:"setFixedSize",value:function(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(this.isWrapFitMode)}},{key:"setResolution",value:function(t){return this.resolution=t,this.update(!1)}},{key:"setLineSpacing",value:function(t){return this.lineSpacing=t,this.update(!1)}},{key:"setXOffset",value:function(t){return this.xOffset=t,this.update(!1)}},{key:"setBackgroundColor",value:function(t,e,n){return void 0===n&&(n=!0),this.backgroundColor=b(t,this.canvas,this.context),this.backgroundColor2=b(e,this.canvas,this.context),this.backgroundHorizontalGradient=n,this.update(!1)}},{key:"setBackgroundStrokeColor",value:function(t,e){return this.backgroundStrokeColor=b(t,this.canvas,this.context),this.backgroundStrokeLineWidth=e,this.update(!1)}},{key:"setBackgroundCornerRadius",value:function(t,e){return this.backgroundCornerRadius=t,this.backgroundCornerIteration=e,this.update(!1)}},{key:"setFill",value:function(t){return this.color=b(t,this.canvas,this.context),this.update(!1)}},{key:"setColor",value:function(t){return this.color=b(t,this.canvas,this.context),this.update(!1)}},{key:"setStroke",value:function(t,e){return void 0===t?this.strokeThickness=0:(void 0===e&&(e=this.strokeThickness),this.stroke=b(t,this.canvas,this.context),this.strokeThickness=e),this.update(!0)}},{key:"setShadow",value:function(t,e,n,i,r,s){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n="#000"),void 0===i&&(i=0),void 0===r&&(r=!1),void 0===s&&(s=!0),this.shadowOffsetX=t,this.shadowOffsetY=e,this.shadowColor=b(n,this.canvas,this.context),this.shadowBlur=i,this.shadowStroke=r,this.shadowFill=s,this.update(!1)}},{key:"setShadowOffset",value:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1)}},{key:"setShadowColor",value:function(t){return void 0===t&&(t="#000"),this.shadowColor=b(t,this.canvas,this.context),this.update(!1)}},{key:"setShadowBlur",value:function(t){return void 0===t&&(t=0),this.shadowBlur=t,this.update(!1)}},{key:"setShadowStroke",value:function(t){return this.shadowStroke=t,this.update(!1)}},{key:"setShadowFill",value:function(t){return this.shadowFill=t,this.update(!1)}},{key:"setUnderline",value:function(t,e,n){return void 0===t&&(t="#000"),void 0===e&&(e=0),void 0===n&&(n=0),this.underlineColor=b(t,this.canvas,this.context),this.underlineThickness=e,this.underlineOffset=n,this.update(!1)}},{key:"setUnderlineColor",value:function(t){return void 0===t&&(t="#000"),this.underlineColor=b(t,this.canvas,this.context),this.update(!1)}},{key:"setUnderlineThickness",value:function(t){return void 0===t&&(t=0),this.underlineThickness=t,this.update(!1)}},{key:"setUnderlineOffset",value:function(t){return void 0===t&&(t=0),this.underlineOffset=t,this.update(!1)}},{key:"setWrapMode",value:function(t){return"string"==typeof t&&(t=F[t.toLowerCase()]||0),this.wrapMode=t,this.update(!0)}},{key:"setWrapWidth",value:function(t){return this.wrapWidth=t,this.update(!1)}},{key:"setAlign",value:function(t,e){return void 0===t&&(t="left"),void 0===e&&(e="top"),this.halign=t,this.valign=e,this.update(!1)}},{key:"setHAlign",value:function(t){return void 0===t&&(t="left"),this.halign=t,this.update(!1)}},{key:"setVAlign",value:function(t){return void 0===t&&(t="top"),this.valign=t,this.update(!1)}},{key:"setMaxLines",value:function(t){return void 0===t&&(t=0),this.maxLines=t,this.update(!1)}},{key:"getTextMetrics",value:function(){var t=this.metrics;return{ascent:t.ascent,descent:t.descent,fontSize:t.fontSize}}},{key:"setTextMetrics",value:function(t,e){return this.metrics.ascent=t.ascent,this.metrics.descent=t.descent,this.metrics.fontSize=t.fontSize,"string"==typeof e?(this.fontFamily=e,this.fontSize="",this.fontStyle=""):(this.fontFamily=P(e,"fontFamily",this.fontFamily),this.fontSize=P(e,"fontSize",this.fontSize),this.fontStyle=P(e,"fontStyle",this.fontStyle)),this.parent.updateText(!0)}},{key:"lineHeight",get:function(){return this.metrics.fontSize+this.strokeThickness+this.lineSpacing}},{key:"toJSON",value:function(){var t={};for(var e in O)t[e]=this[e];return t.metrics=this.getTextMetrics(),t}},{key:"destroy",value:function(){this.parent=void 0}}]),t}(),F={none:x,word:w,char:m,character:m},L=Phaser.Display.Canvas.CanvasPool,z=Phaser.Utils.Objects.GetValue,W=function(){function t(n,i,r,s,a){e(this,t),this.cornerRadius={},this._width=0,this._height=0,this.setTo(n,i,r,s,a)}return i(t,[{key:"setTo",value:function(t,e,n,i,r){return this.setPosition(t,e),this.setRadius(r),this.setSize(n,i),this}},{key:"setPosition",value:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this}},{key:"setRadius",value:function(t){var e,n;void 0===t&&(t=0),"number"==typeof t?(e=t,n=t):(e=z(t,"x",0),n=z(t,"y",0));var i=this.cornerRadius;return i.tl=R(z(t,"tl",void 0),e,n),i.tr=R(z(t,"tr",void 0),e,n),i.bl=R(z(t,"bl",void 0),e,n),i.br=R(z(t,"br",void 0),e,n),this}},{key:"setSize",value:function(t,e){return this.width=t,this.height=e,this}},{key:"minWidth",get:function(){var t=this.cornerRadius;return Math.max(t.tl.x+t.tr.x,t.bl.x+t.br.x)}},{key:"minHeight",get:function(){var t=this.cornerRadius;return Math.max(t.tl.y+t.bl.y,t.tr.y+t.br.y)}},{key:"width",get:function(){return this._width},set:function(t){null==t&&(t=0),this._width=Math.max(t,this.minWidth)}},{key:"height",get:function(){return this._height},set:function(t){null==t&&(t=0),this._height=Math.max(t,this.minHeight)}},{key:"radius",get:function(){var t=this.cornerRadius;return Math.max(t.tl.x,t.tl.y,t.tr.x,t.tr.y,t.bl.x,t.bl.y,t.br.x,t.br.y)}}]),t}(),R=function(t,e,n){return void 0===t?{x:e,y:n}:"number"==typeof t?{x:t,y:t}:t},A=Phaser.Math.DegToRad,B=A(0),_=A(90),I=A(180),j=A(270),H=function(t,e,n,i,r,s,a,o){if(null==o)t.ellipse(e,n,i,r,0,s,a);else for(var l,h,u,c=(a-s)/(o+=1),d=0;d<=o;d++)u=s+c*d,l=e+i*Math.cos(u),h=n+r*Math.sin(u),t.lineTo(l,h)},X=function(t,e,n,i,r,s,a,o,l,h,u,c,d){if(function(t,e,n,i,r,s,a){var o,l,h,u,c,d=new W(e,n,i,r,s),f=d.minWidth,g=d.minHeight,v=i>=f?1:i/f,y=r>=g?1:r/g,p=d.cornerRadius;t.save(),t.beginPath(),t.translate(e,n),u=i-(l=(o=p.br).x*v),c=r-(h=o.y*y),t.moveTo(i,c),l>0&&h>0?H(t,u,c,l,h,B,_,a):(t.lineTo(i,r),t.lineTo(u,r)),u=l=(o=p.bl).x*v,c=r-(h=o.y*y),t.lineTo(l,r),l>0&&h>0?H(t,u,c,l,h,_,I,a):(t.lineTo(0,r),t.lineTo(0,c)),u=l=(o=p.tl).x*v,c=h=o.y*y,t.lineTo(0,c),l>0&&h>0?H(t,u,c,l,h,I,j,a):(t.lineTo(0,0),t.lineTo(u,0)),u=i-(l=(o=p.tr).x*v),c=h=o.y*y,t.lineTo(u,0),l>0&&h>0?H(t,u,c,l,h,j,B,a):(t.lineTo(i,0),t.lineTo(i,c)),t.closePath(),t.restore()}(e,n,i,r,s,a,d),null!=o){var f;if(null!=u)(f=c?e.createLinearGradient(0,0,r,0):e.createLinearGradient(0,0,0,s)).addColorStop(0,o),f.addColorStop(1,u),o=f;e.fillStyle=o,e.fill()}null!=l&&h>0&&(e.strokeStyle=l,e.lineWidth=h,e.stroke())},Y={draw:function(t,e,n,i){var r=this.penManager;this.hitAreaManager.clear();var s=this.context;s.save();var a=this.defaultStyle;this.clear(),function(t,e,n,i,r,s,a,o){if(null!=e||null!=n){var l=t.canvas.width,h=t.canvas.height;null==n&&(i=0);var u=i/2;l-=i,h-=i,X(t.canvas,t.context,u,u,l,h,r,e,n,i,s,a,o)}}(this,a.backgroundColor,a.backgroundStrokeColor,a.backgroundStrokeLineWidth,a.backgroundCornerRadius,a.backgroundColor2,a.backgroundHorizontalGradient,a.backgroundCornerIteration),t+=this.startXOffset,e+=this.startYOffset;var o,l,h,u,c,d,f=a.halign,g=a.valign,v=a.lineHeight,y=r.lines,p=y.length,k=a.maxLines;k>0&&p>k?(l=k,h="center"===g?Math.floor((p-l)/2):"bottom"===g?p-l:0):(l=p,h=0),u=h+l;var x=this.rtl,w=x?this.parent.width:void 0;d="center"===g?Math.max((i-l*v)/2,0):"bottom"===g?Math.max(i-l*v-2,0):0,d+=e;for(var m=h;m<u;m++)if(0!==(o=r.getLineWidth(m))){for(var S=y[m],T=S.length,b=f,M=0;M<T;M++){var P=S[M].prop.align;if(P){b=P;break}}c="center"===b?(n-o)/2:"right"===b?x?0:n-o:x?n-o:0,c+=t;for(M=0;M<T;M++)this.drawPen(S[M],c,d,w)}s.restore()},drawPen:function(t,e,n,i){e+=t.x,n+=t.y+(t.prop.y||0),void 0!==i&&(e=i-e);var r=this.canvas,s=this.context;s.save();var a=this.parser.propToContextStyle(this.defaultStyle,t.prop);a.buildFont(),a.syncFont(r,s),a.syncStyle(r,s),a.underlineThickness>0&&t.width>0&&this.drawUnderline(e,n,t.width,a),t.isTextPen&&this.drawText(e,n,t.text,a),t.isImagePen&&this.drawImage(e,n,t.prop.img,a),s.restore(),t.hasAreaMarker&&t.width>0&&this.hitAreaManager.add(t.prop.area,e,n-this.startYOffset,t.width,this.defaultStyle.lineHeight)},clear:function(){var t=this.canvas;this.context.clearRect(0,0,t.width,t.height)},drawUnderline:function(t,e,n,i){e+=i.underlineOffset-i.underlineThickness/2,this.autoRound&&(t=Math.round(t),e=Math.round(e));var r=this.context,s=r.lineCap;r.lineCap="butt",r.strokeStyle=i.underlineColor,r.lineWidth=i.underlineThickness,r.beginPath(),r.moveTo(t,e),r.lineTo(t+n,e),r.stroke(),r.lineCap=s},drawText:function(t,e,n,i){this.autoRound&&(t=Math.round(t),e=Math.round(e));var r=this.context;i.stroke&&"none"!==i.stroke&&i.strokeThickness>0&&(i.syncShadow(r,i.shadowStroke),r.strokeText(n,t,e)),i.color&&"none"!==i.color&&(i.syncShadow(r,i.shadowFill),r.fillText(n,t,e))},drawImage:function(t,e,n,i){e-=this.startYOffset,this.parent.imageManager.draw(n,this.context,t,e,this.autoRound)}},G=function(){function t(){e(this,t),this.items=[]}return i(t,[{key:"destroy",value:function(){this.clear(),this.items=void 0}},{key:"pop",value:function(){return this.items.length>0?this.items.pop():null}},{key:"push",value:function(t){return this.items.push(t),this}},{key:"pushMultiple",value:function(t){return this.items.push.apply(this.items,t),t.length=0,this}},{key:"clear",value:function(){return this.items.length=0,this}}]),t}(),U=Phaser.Utils.Objects.GetValue,D=y,V=p,N=function(){function t(n){e(this,t),this.prop={},this.resetFromJSON(n)}return i(t,[{key:"resetFromJSON",value:function(t){this.text=U(t,"text",""),this.x=U(t,"x",0),this.y=U(t,"y",0),this.width=U(t,"width",0);var e=U(t,"prop",null);null===e&&(e={}),this.prop=e,this.newLineMode=U(t,"newLineMode",0),this.startIndex=U(t,"startIndex",0)}},{key:"plainText",get:function(){var t=this.text;return this.newLineMode===V&&(t+="\n"),t}},{key:"wrapText",get:function(){var t=this.text;return this.newLineMode!==D&&(t+="\n"),t}},{key:"rawTextLength",get:function(){var t=this.text.length;return this.newLineMode===V&&(t+=1),t}},{key:"endIndex",get:function(){return this.startIndex+this.rawTextLength}},{key:"lastX",get:function(){return this.x+this.width}},{key:"isTextPen",get:function(){return""!==this.text}},{key:"isImagePen",get:function(){return!!this.prop.img}},{key:"hasAreaMarker",get:function(){return!!this.prop.area}}]),t}(),J=function(t,e){var n=Array.isArray(t);if(void 0===e?e=n?[]:{}:function(t){if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e]}(e),n){e.length=t.length;for(var i=0,r=t.length;i<r;i++)e[i]=t[i]}else for(var s in t)e[s]=t[s];return e},E=function(){},q=Phaser.Utils.Objects.GetFastValue,$=y,K=k,Q=new G,Z=new G,tt=function(){function t(n){e(this,t),this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.PensPool=q(n,"pensPool",Q),this.LinesPool=q(n,"linesPool",Z),this.tagToText=q(n,"tagToText",E),this.tagToTextScope=q(n,"tagToTextScope",void 0)}return i(t,[{key:"destroy",value:function(){this.clear(),this.tagToText=void 0,this.tagToTextScope=void 0}},{key:"clear",value:function(){for(var t=0,e=this.lines.length;t<e;t++)this.lines[t].length=0;this.PensPool.pushMultiple(this.pens),this.LinesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}},{key:"addTextPen",value:function(t,e,n,i,r,s){var a=this.PensPool.pop();return null==a&&(a=new N),et.text=t,et.x=e,et.y=n,et.width=i,et.prop=r,et.newLineMode=s,a.resetFromJSON(et),this.addPen(a),this}},{key:"addImagePen",value:function(t,e,n,i){return this.addTextPen("",t,e,n,i,$),this}},{key:"addNewLinePen",value:function(){var t=this.lastPen,e=t?t.lastX:0,n=t?t.y:0,i=t?J(t.prop):null;return this.addTextPen("",e,n,0,i,K),this}},{key:"addPen",value:function(t){var e=this.lastPen;t.startIndex=null==e?0:e.endIndex,this.pens.push(t);var n=this.lastLine;null==n&&(n=this.LinesPool.pop()||[],this.lines.push(n)),n.push(t),t.newLineMode!==$&&(n=this.LinesPool.pop()||[],this.lines.push(n)),this.maxLinesWidth=void 0}},{key:"clone",value:function(e){null==e&&(e=new t),e.clear();for(var n=0,i=this.lines.length;n<i;n++)for(var r=this.lines[n],s=0,a=r.length;s<a;s++){var o=r[s];e.addPen(o.text,o.x,o.y,o.width,J(o.prop),o.newLineMode)}return e}},{key:"lastPen",get:function(){return this.pens[this.pens.length-1]}},{key:"lastLine",get:function(){return this.lines[this.lines.length-1]}},{key:"getLineStartIndex",value:function(t){if(t>=this.lines.length)return this.getLineEndIndex(t);var e=this.lines[t];return e&&e[0]?e[0].startIndex:0}},{key:"getLineEndIndex",value:function(t){t>=this.lines.length&&(t=this.lines.length-1);var e,n,i=!1;for(e=t;e>=0&&!(i=null!=(n=this.lines[e])&&n.length>0);e--);return i?n[n.length-1].endIndex:0}},{key:"getLineWidth",value:function(t){var e=this.lines[t];if(!e)return 0;var n=e[e.length-1];return null==n?0:n.lastX}},{key:"getMaxLineWidth",value:function(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var t,e=0,n=0,i=this.lines.length;n<i;n++)(t=this.getLineWidth(n))>e&&(e=t);return this.maxLinesWidth=e,e}},{key:"getLineWidths",value:function(){for(var t=[],e=0,n=this.lines.length;e<n;e++)t.push(this.getLineWidth(e));return t}},{key:"linesCount",get:function(){return this.lines.length}},{key:"plainText",get:function(){for(var t="",e=this.pens,n=0,i=e.length;n<i;n++)t+=e[n].plainText;return t}},{key:"rawTextLength",get:function(){for(var t=0,e=this.pens,n=0,i=this.pens.length;n<i;n++)t+=e[n].rawTextLength;return t}},{key:"getSliceTagText",value:function(t,e,n){if(void 0===t&&(t=0),void 0===e){var i=this.lastPen;if(null==i)return"";e=i.endIndex}void 0===n&&(n=!1);for(var r,s,a,o,l,h,u="",c=0,d=this.pens.length;c<d&&((o=(r=this.pens[c]).endIndex)<=t||(r=this.pens[c],s=n?r.wrapText:r.plainText,l=r.prop,(a=r.startIndex)>=t&&o<=e||(s=s.substring(t-a,e-a)),this.tagToTextScope?u+=this.tagToText.call(this.tagToTextScope,s,l,h):u+=this.tagToText(s,l,h),h=l,!(o>=e)));c++);return u}},{key:"length",get:function(){return this.lines.length},set:function(t){this.clear()}}]),t}(),et={},nt=Phaser.Geom.Rectangle,it=new G,rt=function(){function t(){e(this,t),this.hitAreas=[]}return i(t,[{key:"destroy",value:function(){this.clear()}},{key:"clear",value:function(){return it.pushMultiple(this.hitAreas),this}},{key:"add",value:function(t,e,n,i,r){var s=it.pop();return null===s?s=new nt(e,n,i,r):s.setTo(e,n,i,r),s.key=t,this.hitAreas.push(s),this}},{key:"getFirstHitArea",value:function(t,e){for(var n,i=this.hitAreas,r=0,s=i.length;r<s;r++)if((n=i[r]).contains(t,e))return n;return null}},{key:"drawBounds",value:function(t,e,n){void 0===e&&(e=16777215),n&&t.save().scaleCanvas(n.scaleX,n.scaleY).rotateCanvas(n.rotation).translateCanvas(n.x,n.y);for(var i,r=this.hitAreas,s=0,a=r.length;s<a;s++)i=r[s],t.lineStyle(1,e).strokeRect(i.x,i.y,i.width,i.height);return n&&t.restore(),this}}]),t}(),st=function(t,e,n,i){var r=this.hitAreaManager.getFirstHitArea(n,i);if(null!==r){var s=r.key;this.parent.emit("".concat(t,"-").concat(s),e,n,i),this.parent.emit(t,s,e,n,i)}},at=new G,ot=function(t){t&&at.push(t)},lt=function(t,e,n){var i=at.pop();return null===i&&(i={}),i.text=t,i.width=e,i.newLineMode=n,i},ht=y,ut=p,ct=k,dt=x,ft=w,gt=m,vt=S,yt=function t(e,n,i,r,s){r<=0&&(i=dt);var a=[];if(!e||!e.length)return a;for(var o,l,h,c=i===dt,d=i===ft,f=e.split(vt),g=0,v=f.length;g<v;g++)if(o=f[g],h=g===v-1?ht:ut,c){var y=n(o);a.push(lt(o,y,h))}else{var p,k,x,w,m;if(l=0===g?r-s:r,o.length<=100)if((y=n(o))<=l){a.push(lt(o,y,h));continue}d?(k=""===(p=o.split(" "))[p.length-1])&&(p.length-=1):p=o;for(var S,T="",b=0,M=d?n(" "):void 0,P=0,O=p.length;P<O;P++)if(w=n(x=p[P]),m=P===O-1,!d||m&&!k||(x+=" ",w+=M),d&&w>r){""!==T?a.push(lt(T,b,ct)):0===P&&s>0&&a.push(lt("",0,ct)),a.push.apply(a,u(t(x,n,gt,r,0)));var C=a.pop();T=C.text,b=C.width,ot(C)," "===T&&(T="",b=0)}else(S=b+w)>l?(a.push(lt(T,b,ct)),T=x,b=w,l=r):(T+=x,b=S),m&&a.push(lt(T,b,h))}return a},pt=Phaser.Utils.Objects.GetValue,kt=x,xt=y,wt=function(){function t(n){e(this,t),this.parent=n.parent,this.context=pt(n,"context",null),this.canvas=this.context.canvas,this.parser=pt(n,"parser",null),this.defaultStyle=pt(n,"style",null),this.autoRound=!0,this.pensPool=pt(n,"pensPool",null),this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new rt;var i=this.context;this.getTextWidth=function(t){return i.measureText(t).width}}return i(t,[{key:"destroy",value:function(){this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defaultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0)}},{key:"updatePenManager",value:function(t,e,n,i,r){if(void 0===r&&(r=this.penManager),r.clear(),""===t)return r;var s=this.parent.style;if(s.isWrapFitMode){var a=this.parent.padding;n=s.fixedWidth-a.left-a.right}for(var o,l,h,u,c,d,f=this.canvas,g=this.context,v=function(t){return g.measureText(t).width},y=0,p=0,k=s.wrapCallback,x=s.wrapCallbackScope,w=!0,m=this.parser.splitText(t),S=0,T=m.length;S<T;S++)if(o=(u=this.parser.tagTextToProp(m[S],l)).plainText,(l=u.prop).img){var b=this.imageManager.getOuterWidth(l.img);n>0&&e!==kt&&n<y+b&&(r.addNewLinePen(),p+=i,y=0),r.addImagePen(y,p,b,J(l)),y+=b}else if(""!==o){if(g.save(),(h=this.parser.propToContextStyle(this.defaultStyle,l)).buildFont(),h.syncFont(f,g),h.syncStyle(f,g),k){"string"==typeof(c=k.call(x,o,v,n,y))&&(c=c.split("\n"));for(var M=0,P=c.length;M<P;M++)"string"==typeof(O=c[M])?c[M]=lt(O,v(O),M<P-1?2:0):w=!1}else c=yt(o,v,e,n,y);var O;for(M=0,P=c.length;M<P;M++)O=c[M],r.addTextPen(O.text,y,p,O.width,J(l),O.newLineMode),O.newLineMode!==xt?(y=0,p+=i):y+=O.width;w&&(d=c)&&at.pushMultiple(d),c=null,g.restore()}return r}},{key:"startXOffset",get:function(){var t=this.defaultStyle;return t.strokeThickness/2+t.xOffset}},{key:"startYOffset",get:function(){var t=this.defaultStyle;return t.strokeThickness/2+t.metrics.ascent}},{key:"lines",get:function(){return this.penManager.lines}},{key:"desplayLinesCount",get:function(){var t=this.penManager.linesCount,e=this.defaultStyle.maxLines;return e>0&&t>e&&(t=e),t}},{key:"linesWidth",get:function(){return this.penManager.getMaxLineWidth()}},{key:"linesHeight",get:function(){var t=this.desplayLinesCount,e=this.defaultStyle.lineHeight*t;return t>0&&(e-=this.defaultStyle.lineSpacing),e}},{key:"imageManager",get:function(){return this.parent.imageManager}},{key:"rtl",get:function(){return this.parent.style.rtl}},{key:"newPenManager",value:function(){return new tt({pensPool:this.pensPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}},{key:"tmpPenManager",get:function(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}},{key:"getPlainText",value:function(t,e,n){var i;if(null==t)i=this.penManager.plainText;else{var r=this.parser.splitText(t,1);i="";for(var s=0,a=r.length;s<a;s++)i+=r[s]}return null==e&&null==n||(null==e&&(e=0),null==n&&(n=i.length),i=i.substring(e,n)),i}},{key:"getPenManager",value:function(t,e){if(void 0===t)return this.copyPenManager(e,this.penManager);void 0===e&&(e=this.newPenManager());var n=this.defaultStyle;return this.updatePenManager(t,n.wrapMode,n.wrapWidth,n.lineHeight,e),e}},{key:"getText",value:function(t,e,n,i){if(null==t)return this.penManager.getSliceTagText(e,n,i);var r=this.tmpPenManager,s=this.defaultStyle;return this.updatePenManager(t,s.wrapMode,s.wrapWidth,s.lineHeight,r),r.getSliceTagText(e,n,i)}},{key:"copyPenManager",value:function(t,e){return void 0===e&&(e=this.penManager),e.copy(t)}},{key:"getTextWidth",value:function(t){return void 0===t&&(t=this.penManager),t.getMaxLineWidth()}},{key:"getLastPen",value:function(t){return void 0===t&&(t=this.penManager),t.lastPen}}]),t}(),mt={setInteractive:function(){this.parent.on("pointerdown",(function(t,e,n,i){st.call(this,"areadown",t,e,n)}),this).on("pointerup",(function(t,e,n,i){st.call(this,"areaup",t,e,n)}),this)}};Object.assign(wt.prototype,Y,mt);var St=Phaser.Utils.Objects.GetValue,Tt=function(t,e){void 0===e&&(e={key:t}),e.hasOwnProperty("key")||(e.key=t);var n=e.key,i=e.frame,r=e.width,s=e.height;if(void 0===r||void 0===s){var a=this.textureManager.getFrame(n,i),o=a?a.cutWidth:0,l=a?a.cutHeight:0;void 0===r&&void 0===s?(r=o,s=l):void 0===r?r=o*(s/l):void 0===s&&(s=l*(r/o))}this.images[t]={key:n,frame:i,width:r,height:s,y:St(e,"y",0),left:St(e,"left",0),right:St(e,"right",0)}},bt=function(){function t(n){e(this,t),this.textureManager=n.textures,this.images={}}return i(t,[{key:"destroy",value:function(){this.textureManager=void 0,this.images=void 0}},{key:"add",value:function(t,e){if("string"==typeof t)Tt.call(this,t,e);else if(Array.isArray(t))for(var n=0,i=(r=t).length;n<i;n++)Tt.call(this,r[n]);else{var r=t;for(var t in r)Tt.call(this,t,r[t])}return this}},{key:"has",value:function(t){return this.images.hasOwnProperty(t)}},{key:"remove",value:function(t){return this.has(t)&&delete this.images[t],this}},{key:"get",value:function(t){return this.has(t)||this.textureManager.exists(t)&&this.add(t),this.images[t]}},{key:"getOuterWidth",value:function(t){var e=this.get(t);return e?e.width+e.left+e.right:0}},{key:"getFrame",value:function(t){var e=this.get(t);return e?this.textureManager.getFrame(e.key,e.frame):void 0}},{key:"hasTexture",value:function(t){return!!this.getFrame(t)}}]),t}(),Mt={draw:function(t,e,n,i,r){var s=this.get(t);n+=s.left,i+=s.y,r&&(n=Math.round(n),i=Math.round(i));var a=this.textureManager.getFrame(s.key,s.frame);e.drawImage(a.source.image,a.cutX,a.cutY,a.cutWidth,a.cutHeight,n,i,s.width,s.height)}};Object.assign(bt.prototype,Mt);var Pt=Phaser.Utils.Objects.IsPlainObject,Ot=Phaser.DOM.AddToDOM,Ct=Phaser.Display.Canvas.CanvasPool,Ft=Phaser.GameObjects.GameObject,Lt=Phaser.Utils.Objects.GetValue,zt=Phaser.DOM.RemoveFromDOM,Wt=S,Rt={},At=function(n){r(a,Ft);var s=h(a);function a(t,n,i,r,l,h,u){var c;if(e(this,a),Pt(n)){var d=n;n=Lt(d,"x",0),i=Lt(d,"y",0),r=Lt(d,"text",""),l=Lt(d,"style","")}if(void 0===n&&(n=0),void 0===i&&(i=0),(c=s.call(this,t,h)).renderer=t.sys.game.renderer,c.setPosition(n,i),c.setOrigin(0,0),c.initPipeline(),c.canvas=Ct.create(o(c)),c.context=c.canvas.getContext("2d"),c._imageManager=void 0,l){if(l.hasOwnProperty("align")){var f=l.align;delete l.align,l.halign=f}l.hasOwnProperty("stroke")&&!l.hasOwnProperty("strokeThickness")&&(l.strokeThickness=1)}return c.style=new C(o(c),l),c.autoRound=!0,c._text=void 0,c.padding={left:0,right:0,top:0,bottom:0},c.width=1,c.height=1,c.dirty=!1,0===c.style.resolution&&(c.style.resolution=1),c._crop=c.resetCropObject(),c.texture=t.sys.textures.addCanvas(null,c.canvas,!0),c.frame=c.texture.get(),c.frame.source.resolution=c.style.resolution,c.renderer.gl&&(c.renderer.deleteTexture(c.frame.source.glTexture),c.frame.source.glTexture=null),Rt.hasOwnProperty(h)||(Rt[h]=new G),c.canvasText=new wt({parent:o(c),context:c.context,parser:u,style:c.style,pensPool:Rt[h]}),c.initRTL(),l&&l.padding&&c.setPadding(l.padding),c.setText(r),t.sys.game.events.on("contextrestored",c.onContextRestored,o(c)),c}return i(a,[{key:"onContextRestored",value:function(){this.dirty=!0}},{key:"preDestroy",value:function(){this.style.rtl&&zt(this.canvas),this.scene.sys.game.events.off("contextrestored",this.onContextRestored,this),this.canvasText.destroy(),this.canvasText=void 0,this._imageManager&&(this._imageManager.destroy(),this._imageManager=void 0),Ct.remove(this.canvas),this.texture.destroy()}},{key:"text",get:function(){return this._text},set:function(t){this.setText(t)}},{key:"initRTL",value:function(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",Ot(this.canvas,this.scene.sys.canvas),this.originX=1)}},{key:"setText",value:function(t){return null==t&&(t=""),Array.isArray(t)&&(t=t.join("\n")),t!==this._text&&(this._text=t.toString(),this.updateText()),this}},{key:"appendText",value:function(t){return null==t||(Array.isArray(t)&&(t=t.join("\n")),this.setText(this.text+t.toString())),this}},{key:"setStyle",value:function(t){return this.style.setStyle(t)}},{key:"setFont",value:function(t){return this.style.setFont(t)}},{key:"setFontFamily",value:function(t){return this.style.setFontFamily(t)}},{key:"setFontSize",value:function(t){return this.style.setFontSize(t)}},{key:"setFontStyle",value:function(t){return this.style.setFontStyle(t)}},{key:"setTestString",value:function(t){return this.style.setTestString(t)}},{key:"setFixedSize",value:function(t,e){return this.style.setFixedSize(t,e)}},{key:"setBackgroundColor",value:function(t,e,n){return this.style.setBackgroundColor(t,e,n)}},{key:"setBackgroundStrokeColor",value:function(t,e){return this.style.setBackgroundStrokeColor(t,e)}},{key:"setBackgroundCornerRadius",value:function(t,e){return this.style.setBackgroundCornerRadius(t,e)}},{key:"setFill",value:function(t){return this.style.setFill(t)}},{key:"setColor",value:function(t){return this.style.setColor(t)}},{key:"setStroke",value:function(t,e){return this.style.setStroke(t,e)}},{key:"setShadow",value:function(t,e,n,i,r,s){return this.style.setShadow(t,e,n,i,r,s)}},{key:"setShadowOffset",value:function(t,e){return this.style.setShadowOffset(t,e)}},{key:"setShadowColor",value:function(t){return this.style.setShadowColor(t)}},{key:"setShadowBlur",value:function(t){return this.style.setShadowBlur(t)}},{key:"setShadowStroke",value:function(t){return this.style.setShadowStroke(t)}},{key:"setShadowFill",value:function(t){return this.style.setShadowFill(t)}},{key:"setWrapMode",value:function(t){return this.style.setWrapMode(t)}},{key:"setWrapWidth",value:function(t){return this.style.setWrapWidth(t)}},{key:"setAlign",value:function(t){return this.style.setHAlign(t)}},{key:"setHAlign",value:function(t){return this.style.setHAlign(t)}},{key:"setVAlign",value:function(t){return this.style.setVAlign(t)}},{key:"setLineSpacing",value:function(t){return this.style.setLineSpacing(t)}},{key:"setXOffset",value:function(t){return this.style.setXOffset(t)}},{key:"setPadding",value:function(e,n,i,r){if("object"===t(e)){var s=e,a=Lt(s,"x",null);null!==a?(e=a,i=a):(e=Lt(s,"left",0),i=Lt(s,"right",e));var o=Lt(s,"y",null);null!==o?(n=o,r=o):(n=Lt(s,"top",0),r=Lt(s,"bottom",n))}else void 0===e&&(e=0),void 0===n&&(n=e),void 0===i&&(i=e),void 0===r&&(r=n);return this.padding.left=e,this.padding.top=n,this.padding.right=i,this.padding.bottom=r,this.updateText(!1)}},{key:"setMaxLines",value:function(t){return this.style.setMaxLines(t)}},{key:"setResolution",value:function(t){return this.style.setResolution(t)}},{key:"updateText",value:function(t){void 0===t&&(t=!0);var e=this.canvasText,n=this.style;t&&e.updatePenManager(this._text,n.wrapMode,n.wrapWidth,n.lineHeight);var i,r,s=this.padding;0===n.fixedWidth?(this.width=e.linesWidth+s.left+s.right,i=e.linesWidth):(this.width=n.fixedWidth,(i=this.width-s.left-s.right)<e.linesWidth&&(i=e.linesWidth)),0===n.fixedHeight?(this.height=e.linesHeight+s.top+s.bottom,r=e.linesHeight):(this.height=n.fixedHeight,(r=this.height-s.top-s.bottom)<e.linesHeight&&(r=e.linesHeight));var a=this.width,o=this.height;this.updateDisplayOrigin();var l=n.resolution;a*=l,o*=l,a=Math.max(Math.ceil(a),1),o=Math.max(Math.ceil(o),1);var h=this.canvas,u=this.context;h.width!==a||h.height!==o?(h.width=a,h.height=o,this.frame.setSize(a,o)):u.clearRect(0,0,a,o),u.save(),u.scale(l,l);var c=this.style.rtl?s.right:s.left,d=s.top;e.draw(c,d,i,r),u.restore(),this.renderer&&this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(h,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!0;var f=this.input;return f&&!f.customHitArea&&(f.hitArea.width=this.width,f.hitArea.height=this.height),this}},{key:"getTextMetrics",value:function(){return this.style.getTextMetrics()}},{key:"setTextMetrics",value:function(t,e){return this.style.setTextMetrics(t,e)}},{key:"toJSON",value:function(){var t=Bt.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t}},{key:"setInteractive",value:function(t,e,n){return Ft.prototype.setInteractive.call(this,t,e,n),this.canvasText.setInteractive(),this}},{key:"getWrappedText",value:function(t,e,n){return(t=this.canvasText.getText(t,e,n,!0)).split(Wt)}},{key:"getPlainText",value:function(t,e,n){return this.canvasText.getPlainText(t,e,n)}},{key:"getText",value:function(t,e,n,i){return void 0===i&&(i=!1),this.canvasText.getText(t,e,n,i)}},{key:"getSubString",value:function(t,e,n){return this.getText(t,e,n)}},{key:"copyPenManager",value:function(t){return this.canvasText.copyPenManager(t)}},{key:"getPenManager",value:function(t,e){return this.canvasText.getPenManager(t,e)}},{key:"setSize",value:function(t,e){return this.setFixedSize(t,e)}},{key:"resize",value:function(t,e){return this.setFixedSize(t,e)}},{key:"lineSpacing",get:function(){return this.style.lineSpacing},set:function(t){this.setLineSpacing(t)}},{key:"imageManager",get:function(){return this._imageManager||(this._imageManager=new bt(this.scene)),this._imageManager}},{key:"addImage",value:function(t,e){return this.imageManager.add(t,e),this}},{key:"drawAreaBounds",value:function(t,e){return this.canvasText.hitAreaManager.drawBounds(t,e,this),this}},{key:"measureTextMargins",value:function(t,e){return function(t,e,n){void 0===n&&(n={});var i=L.create(this),r=i.getContext("2d");t.syncFont(i,r);var s=r.measureText(e),a=Math.ceil(s.width*t.baselineX),o=a,l=2*o;if(o=o*t.baselineY|0,i.width=a,i.height=l,r.fillStyle="#f00",r.fillRect(0,0,a,l),r.font=t._font,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(t.testString,0,o),n.left=0,0===a||0===l||!r.getImageData(0,0,a,l))return L.remove(i),n;for(var h=r.getImageData(0,0,a,l).data,u=!1,c=0;c<a;c++){for(var d=0;d<l;d++){if(255!==h[4*(d*a+c)]){n.left=c,u=!0;break}}if(u)break}return L.remove(i),n}(this.style,t,e)}},{key:"generateTexture",value:function(t,e,n,i,r){var s=this.canvas;return void 0===i?i=s.width:i*=this.resolution,void 0===r?r=s.height:r*=this.resolution,function(t,e,n,i,r,s,a){var o,l=t.textures,h=t.renderer;void 0===i&&(i=0),void 0===r&&(r=0),void 0===s&&(s=e.width),void 0===a&&(a=e.height);var u=(o=l.exists(n)?l.get(n):l.createCanvas(n,s,a)).getSourceImage();u.width!==s&&(u.width=s),u.height!==a&&(u.height=a);var c=u.getContext("2d");c.clearRect(0,0,s,a),c.drawImage(e,i,r,s,a),h.gl&&o&&h.canvasToTexture(u,o.source[0].glTexture,!0,0)}(this.scene,s,t,e,n,i,r),this}}]),a}(),Bt=Phaser.GameObjects.Components;Phaser.Class.mixin(At,[Bt.Alpha,Bt.BlendMode,Bt.ComputedSize,Bt.Crop,Bt.Depth,Bt.Flip,Bt.GetBounds,Bt.Mask,Bt.Origin,Bt.Pipeline,Bt.ScrollFactor,Bt.Tint,Bt.Transform,Bt.Visible,f]);var _t={plainText:null,prevProp:null},It=new C,jt={},Ht={splitText:function(t,e){for(var n=[],i=0;;){var r=Gt.exec(t);if(!r){var s=t.length;return i<s&&n.push(t.substring(i,s)),n}var a=r[0],o=Gt.lastIndex-a.length;i<o&&n.push(t.substring(i,o)),void 0===e&&n.push(a),i=Gt.lastIndex}},tagTextToProp:function(t,e){var n,i;null==e&&(e={}),e.img&&Xt(e,fe,"img"),Ut.test(t)?(Xt(e,ge,"b",!0),n=""):Dt.test(t)?(Xt(e,fe,"b"),n=""):Vt.test(t)?(Xt(e,ge,"i",!0),n=""):Nt.test(t)?(Xt(e,fe,"i"),n=""):Jt.test(t)?(i=t.match(Jt),Xt(e,ge,"size","".concat(i[1],"px")),n=""):Et.test(t)?(Xt(e,fe,"size"),n=""):qt.test(t)?(i=t.match(qt),Xt(e,ge,"color",i[1]),n=""):$t.test(t)?(Xt(e,fe,"color"),n=""):Kt.test(t)?(i=t.match(Kt),Xt(e,ge,"u",!0),n=""):Qt.test(t)?(i=t.match(Qt),Xt(e,ge,"u",i[1]),n=""):Zt.test(t)?(Xt(e,fe,"u"),n=""):te.test(t)?(Xt(e,ge,"shadow",!0),n=""):ee.test(t)?(Xt(e,fe,"shadow"),n=""):ne.test(t)?(Xt(e,ge,"stroke",!0),n=""):ie.test(t)?(i=t.match(ie),Xt(e,ge,"stroke",i[1]),n=""):re.test(t)?(Xt(e,fe,"stroke"),n=""):se.test(t)?(i=t.match(se),Xt(e,ge,"y",parseFloat(i[1])),n=""):ae.test(t)?(Xt(e,fe,"y"),n=""):oe.test(t)?(i=t.match(oe),Xt(e,ge,"img",i[1]),n=""):le.test(t)?(Xt(e,fe,"img"),n=""):he.test(t)?(i=t.match(he),Xt(e,ge,"area",i[1]),n=""):ue.test(t)?(Xt(e,fe,"area"),n=""):ce.test(t)?(i=t.match(ce),Xt(e,ge,"align",i[1]),n=""):de.test(t)?(Xt(e,fe,"align"),n=""):n=t;var r=_t;return r.plainText=n,r.prop=e,r},propToContextStyle:function(t,e){var n=It;if(e.hasOwnProperty("img"))n.image=e.img;else{if(n.image=null,e.hasOwnProperty("family")?n.fontFamily=e.family:n.fontFamily=t.fontFamily,e.hasOwnProperty("size")){var i=e.size;"number"==typeof i&&(i="".concat(i,"px")),n.fontSize=i}else n.fontSize=t.fontSize;n.fontStyle=Yt(e.b,e.i),e.hasOwnProperty("color")?n.color=e.color:n.color=t.color,e.hasOwnProperty("stroke")?!0===e.stroke?(n.stroke=t.stroke,n.strokeThickness=t.strokeThickness):(n.stroke=e.stroke,n.strokeThickness=t.strokeThickness):(n.stroke=t.stroke,n.strokeThickness=0)}return e.hasOwnProperty("shadow")?!0===e.shadow?(n.shadowColor=t.shadowColor,n.shadowOffsetX=t.shadowOffsetX,n.shadowOffsetY=t.shadowOffsetY,n.shadowBlur=t.shadowBlur,n.shadowStroke=!0,n.shadowFill=!0):(n.shadowColor=e.shadow,n.shadowOffsetX=t.shadowOffsetX,n.shadowOffsetY=t.shadowOffsetY,n.shadowBlur=t.shadowBlur,n.shadowStroke=!0,n.shadowFill=!0):(n.shadowColor="#000",n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=0,n.shadowStroke=!1,n.shadowFill=!1),e.hasOwnProperty("u")?!0===e.u?(n.underlineColor=t.underlineColor,n.underlineThickness=t.underlineThickness,n.underlineOffset=t.underlineOffset):(n.underlineColor=e.u,n.underlineThickness=t.underlineThickness,n.underlineOffset=t.underlineOffset):(n.underlineColor="#000",n.underlineThickness=0,n.underlineOffset=0),n},propToTagText:function(t,e,n){null==n&&(n=jt);var i=[];for(var r in n)e.hasOwnProperty(r)||i.push("[/".concat(r,"]"));for(var r in e){var s=e[r];if(n[r]!==s)switch(r){case"size":i.push("[size=".concat(s.replace("px",""),"]"));break;case"color":case"stroke":case"y":case"img":case"area":case"align":i.push("[".concat(r,"=").concat(s,"]"));break;case"u":!0===s?i.push("[u]"):i.push("[u=".concat(s,"]"));break;default:i.push("[".concat(r,"]"))}}return i.push(t),i.join("")}},Xt=function(t,e,n,i){return e===ge?t[n]=i:t.hasOwnProperty(n)&&delete t[n],t},Yt=function(t,e){return t&&e?"bold italic":t?"bold":e?"italic":""},Gt=/\[b\]|\[\/b\]|\[i\]|\[\/i\]|\[size=(\d+)\]|\[\/size\]|\[color=([a-z]+|#[0-9abcdef]+)\]|\[\/color\]|\[u\]|\[u=([a-z]+|#[0-9abcdef]+)\]|\[\/u\]|\[shadow\]|\[\/shadow\]|\[stroke\]|\[stroke=([a-z]+|#[0-9abcdef]+)\]|\[\/stroke\]|\[y=([-.0-9]+)\]|\[\/y\]|\[img=([^\]]+)\]|\[\/img\]|\[area=([^\]]+)\]|\[\/area\]|\[align=([^\]]+)\]|\[\/align\]/gi,Ut=/\[b\]/i,Dt=/\[\/b\]/i,Vt=/\[i\]/i,Nt=/\[\/i\]/i,Jt=/\[size=(\d+)\]/i,Et=/\[\/size\]/i,qt=/\[color=([a-z]+|#[0-9abcdef]+)\]/i,$t=/\[\/color\]/i,Kt=/\[u\]/i,Qt=/\[u=([a-z]+|#[0-9abcdef]+)\]/i,Zt=/\[\/u\]/i,te=/\[shadow\]/i,ee=/\[\/shadow\]/i,ne=/\[stroke\]/i,ie=/\[stroke=([a-z]+|#[0-9abcdef]+)\]/i,re=/\[\/stroke\]/i,se=/\[y=([-.0-9]+)\]/i,ae=/\[\/y\]/i,oe=/\[img=([^\]]+)\]/i,le=/\[\/img\]/i,he=/\[area=([^\]]+)\]/i,ue=/\[\/area\]/i,ce=/\[align=([^\]]+)\]/i,de=/\[\/align\]/i,fe=!1,ge=!0,ve=function(t){r(i,At);var n=h(i);function i(t,r,s,a,o){return e(this,i),n.call(this,t,r,s,a,o,"rexBBCodeText",Ht)}return i}();function ye(t,e,n,i){var r=new ve(this.scene,t,e,n,i);return this.scene.add.existing(r),r}var pe=Phaser.Utils.Objects.GetAdvancedValue,ke=Phaser.GameObjects.BuildGameObject;function xe(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var n=pe(t,"text",""),i=pe(t,"style",null),r=pe(t,"padding",null);null!==r&&(i.padding=r);var s=new ve(this.scene,0,0,n,i);return ke(this.scene,s,t),s.autoRound=pe(t,"autoRound",!0),s}var we=function(t){return null==t||""===t||0===t.length},me=function(t){r(s,Phaser.Plugins.BasePlugin);var n=h(s);function s(t){var i;return e(this,s),i=n.call(this,t),t.registerGameObject("rexBBCodeText",ye,xe),i}return i(s,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}}]),s}();!function(e,n,i){if("object"===t(e)){if(we(n)){if(null==i)return;"object"===t(i)&&(e=i)}else{"string"==typeof n&&(n=n.split("."));var r=n.pop();(function(e,n,i){var r=e;if(we(n));else{var s;"string"==typeof n&&(n=n.split("."));for(var a=0,o=n.length;a<o;a++){var l;if(null==r[s=n[a]]||"object"!==t(r[s]))l=a===o-1?void 0===i?{}:i:{},r[s]=l;r=r[s]}}return r}(e,n))[r]=i}}}(window,"RexPlugins.GameObjects.BBCodeText",ve);export{me as default};
