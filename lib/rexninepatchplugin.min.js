function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function i(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=s(t);if(e){var n=s(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return c(this,r)}}function h(t,e,r){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(r):n.value}})(t,e,r||t)}var u=function e(r){var i,n,s;if("object"!==t(r)||null===r)return r;for(s in i=Array.isArray(r)?[]:{},r)n=r[s],i[s]=e(n);return i},l=function(t,e,r){return void 0===r&&(r="image"),t[e]||(t[e]=t.scene.make[r]({add:!1,origin:{x:0,y:0}}),t.once("destroy",(function(){t[e]&&(t[e].destroy(),t[e]=void 0)}))),t[e]},f=Phaser.Utils.Objects.IsPlainObject,d=Phaser.Utils.Objects.GetValue,m=function(t){return"string"==typeof t&&(t=v[t]),t},v={scale:0,repeat:1},y=function(t,e){return 0===t||t===this.columns.count-1||0===e||e===this.rows.count-1},p={setTexture:function(t,e,r,i){Array.isArray(e)&&(i=r,r=e,e=void 0),void 0===e&&(e="__BASE"),r=u(r),i=u(i),this.textureKey=t,this.baseFrameName=e,this.columns.data=r,this.columns.count=r?r.length:0,this.columns.stretch=0,this.columns.minWidth=0,this.columns.scale=1,this.rows.data=i,this.rows.count=i?i.length:0,this.rows.stretch=0,this.rows.minHeight=0,this.rows.scale=1;var n=this.scene.textures.get(t);if(!n)return this.clear(),this;if(!r||!i)return this.clear(),this;for(var s=n.frames[e],o=s.width,c=0,a=0,h=r.length;a<h;a++)void 0===r[a]?c++:"number"==typeof r[a]?o-=r[a]:o-=r[a].width;var l=o/c,f=s.height,d=0;for(a=0,h=i.length;a<h;a++)void 0===i[a]?d++:"number"==typeof i[a]?f-=i[a]:f-=i[a].width;for(var m,v,y,p,g,b=f/d,w=0,x=0,P=0,S=i.length;P<S;P++){void 0===i[P]&&(i[P]=b),"number"==typeof i[P]&&(i[P]={height:i[P],stretch:P%2}),y=(m=i[P]).height,this.rows.stretch+=0|m.stretch,this.rows.minHeight+=m.stretch>0?0:y,w=0;a=0;for(var O=r.length;a<O;a++)void 0===r[a]&&(r[a]=l),"number"==typeof r[a]&&(r[a]={width:r[a],stretch:a%2}),p=(v=r[a]).width,0===P&&(this.columns.stretch+=0|v.stretch,this.columns.minWidth+=v.stretch>0?0:p),p>=1&&y>=1&&(g=this.getFrameNameCallback(a,P,e))&&n.add(g,0,w+s.cutX,x+s.cutY,p,y),w+=p;x+=y}return this.updateTexture(),this},updateTexture:function(){if(this.clear(),void 0===this.textureKey)return this;var t=this.scene.textures.get(this.textureKey);if(!t)return this;var e,r,i,n,s,o,c,a=this.columns.minWidth*this.maxFixedPartScaleX,h=this.rows.minHeight*this.maxFixedPartScaleY,u=this.width-a,f=this.height-h,d=u>=0?this.maxFixedPartScaleX:this.width/a,m=f>=0?this.maxFixedPartScaleY:this.height/h;if(this.preserveRatio){var v=Math.min(d,m);if(d>v){var y=(d-v)*a;u>=0?u+=y:u=y,d=v}if(m>v){var p=(m-v)*h;f>=0?f+=p:f=p,m=v}}this.columns.scale=d,this.rows.scale=m,e=u>0&&this.columns.stretch>0?u/this.columns.stretch:0,r=f>0&&this.rows.stretch>0?f/this.rows.stretch:0;for(var g,b=0,w=0,x=0,P=this.rows.count;x<P;x++){c=0===(s=this.rows.data[x]).stretch?s.height*m:r*s.stretch,b=0;for(var S=0,O=this.columns.count;S<O;S++)o=0===(n=this.columns.data[S]).stretch?n.width*d:e*n.stretch,(i=this.getFrameNameCallback(S,x,this.baseFrameName))&&o>0&&c>0&&t.has(i)&&(0===(0===s.stretch&&0===n.stretch||0===this.getStretchMode(S,x)?0:1)?(g=l(this,"_image","image")).setTexture(this.textureKey,i).setDisplaySize(o,c):(g=l(this,"_tileSprite","tileSprite")).setTexture(this.textureKey,i).setSize(o,c)),g&&(this.draw(g,b,w),g=void 0),b+=o;w+=c}},setStretchMode:function(t){return f(t)?(this.stretchMode.edge=m(d(t,"edge",0)),this.stretchMode.internal=m(d(t,"internal",0))):(t=m(t),this.stretchMode.edge=t,this.stretchMode.internal=t),this},getStretchMode:function(t,e){return y.call(this,t,e)?this.stretchMode.edge:this.stretchMode.internal},setPreserveRatio:function(t){return null==t&&(t=!0),this.preserveRatio=t,this},setMaxFixedPartScale:function(t,e){return void 0===e&&(e=t),this.maxFixedPartScaleX=t,this.maxFixedPartScaleY=e,this}},g=function(t,e,r){return"__BASE"===r?"".concat(t,",").concat(e):"".concat(r,"_").concat(t,",").concat(e)},b=Phaser.GameObjects.RenderTexture,w=Phaser.Utils.Objects.IsPlainObject,x=Phaser.Utils.Objects.GetValue,P=function(t){n(o,b);var r=a(o);function o(t,i,n,s,c,a,h,u,l,f){var d;e(this,o),w(i)?(i=x(f=i,"x",0),n=x(f,"y",0),s=x(f,"width",1),c=x(f,"height",1),a=x(f,"key",void 0),h=x(f,"baseFrame",void 0),u=x(f,"columns",void 0),l=x(f,"rows",void 0)):w(s)?(s=x(f=s,"width",1),c=x(f,"height",1),a=x(f,"key",void 0),h=x(f,"baseFrame",void 0),u=x(f,"columns",void 0),l=x(f,"rows",void 0)):w(a)?(a=x(f=a,"key",void 0),h=x(f,"baseFrame",void 0),u=x(f,"columns",void 0),l=x(f,"rows",void 0)):w(h)?(h=x(f=h,"baseFrame",void 0),u=x(f,"columns",void 0),l=x(f,"rows",void 0)):Array.isArray(h)?(f=l,l=u,u=h,h=x(f,"baseFrame",void 0)):w(u)&&(u=x(f=u,"columns",void 0),l=x(f,"rows",void 0)),(d=r.call(this,t,i,n,s,c)).columns={},d.rows={},d.stretchMode={},d._tileSprite=void 0,d._image=void 0,d.setOrigin(.5,.5),d.setGetFrameNameCallback(x(f,"getFrameNameCallback",void 0)),d.setStretchMode(x(f,"stretchMode",0)),d.setPreserveRatio(x(f,"preserveRatio",!0));var m=x(f,"maxFixedPartScale",1),v=x(f,"maxFixedPartScaleX",m),y=x(f,"maxFixedPartScaleY",void 0);return d.setMaxFixedPartScale(v,y),d.setTexture(a,h,u,l),d}return i(o,[{key:"setGetFrameNameCallback",value:function(t){return void 0===t&&(t=g),this.getFrameNameCallback=t,this}},{key:"minWidth",get:function(){return this.columns.minWidth}},{key:"minHeight",get:function(){return this.rows.minHeight}},{key:"fixedPartScaleX",get:function(){return this.columns.scale}},{key:"fixedPartScaleY",get:function(){return this.rows.scale}},{key:"resize",value:function(t,e){return this.width===t&&this.height===e||(h(s(o.prototype),"resize",this).call(this,t,e),this.updateTexture()),this}}]),o}();function S(t,e,r,i,n,s,o,c,a){var h=new P(this.scene,t,e,r,i,n,s,o,c,a);return this.scene.add.existing(h),h}Object.assign(P.prototype,p);var O=Phaser.GameObjects.BuildGameObject;function j(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var r=new P(this.scene,t);return O(this.scene,r,t),r}var F=function(t){return null==t||""===t||0===t.length},k=function(t){n(s,Phaser.Plugins.BasePlugin);var r=a(s);function s(t){var i;return e(this,s),i=r.call(this,t),t.registerGameObject("rexNinePatch",S,j),i}return i(s,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}}]),s}();!function(e,r,i){if("object"===t(e)){if(F(r)){if(null==i)return;"object"===t(i)&&(e=i)}else{"string"==typeof r&&(r=r.split("."));var n=r.pop();(function(e,r,i){var n=e;if(F(r));else{var s;"string"==typeof r&&(r=r.split("."));for(var o=0,c=r.length;o<c;o++){var a;if(null==n[s=r[o]]||"object"!==t(n[s]))a=o===c-1?void 0===i?{}:i:{},n[s]=a;n=n[s]}}return n}(e,r))[n]=i}}}(window,"RexPlugins.GameObjects.NinePatch",P);export{k as default};
